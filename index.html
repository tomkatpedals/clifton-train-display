<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clifton Station Departures</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #000;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #ccc;
    }
    #departures {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .departure-card {
      padding: 15px;
      border-radius: 8px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Clifton Station Departures</h1>
  <div id="departures">Loading...</div>

<script>
  async function loadDepartures() {
    const res = await fetch("departures.json");
    const data = await res.json();

    const container = document.getElementById("departures");
    container.innerHTML = "";

    const now = new Date();

    data.forEach(train => {
      const [hourStr, minuteStr] = train.departure_time.split(":");
      const depDate = new Date(now);
      depDate.setHours(parseInt(hourStr));
      depDate.setMinutes(parseInt(minuteStr));
      depDate.setSeconds(0);
      depDate.setMilliseconds(0);

      // Adjust for departures just after midnight
      if (depDate < now) depDate.setDate(depDate.getDate() + 1);

      const diffMs = depDate - now;
      const diffMin = Math.round(diffMs / 60000);

      // ðŸ§¹ Skip if departure is in the past (with 1 min buffer)
      if (diffMin < 1) return;

      const hours = depDate.getHours();
      const minutes = depDate.getMinutes().toString().padStart(2, "0");
      const ampm = hours >= 12 ? "PM" : "AM";
      const hr12 = hours % 12 || 12;
      const depTimeStr = `${hr12}:${minutes} ${ampm}`;

      let displayText = "";
      if (diffMin < 60) {
        displayText = `${train.trip_headsign} â€” ${depTimeStr} (in ${diffMin} min)`;
      } else {
        displayText = `${train.trip_headsign} â€” at ${depTimeStr}`;
      }

      const card = document.createElement("div");
      card.className = "departure-card";

      if (train.trip_headsign.toLowerCase().includes("hoboken")) {
        card.style.backgroundColor = "#ffffff";
        card.style.color = "#000000";
      } else {
        card.style.backgroundColor = "#666666";
        card.style.color = "#ffffff";
      }

      card.innerText = displayText;
      container.appendChild(card);
    });

    // Fallback if nothing upcoming
    if (container.innerHTML === "") {
      container.innerText = "No more trains scheduled today.";
    }
  }

  loadDepartures();
</script>
</body>
</html>
