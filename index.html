<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Clifton Departures</title>
<style>
  body {
    font-family: sans-serif;
    margin: 0;
    padding: 1rem;
    background: #ffffff; /* white background */
  }

  h1 {
    text-align: left;
    margin-bottom: 1rem;
  }

  .card {
    width: 100%;
    border: 1px solid #ccc; /* thin gray border */
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    background-color: #ffffff;
    text-align: left;
    font-size: 1.25rem;
    box-sizing: border-box;
  }
</style>

</head>
<body>
  <h1>Clifton Station Departures</h1>
  <div id="departures">Loading…</div>

  <script>
  fetch("departures.json")
    .then((res) => res.json())
    .then((departures) => {
      const container = document.getElementById("departures");

      const now = new Date();
      departures.forEach((dep) => {
        const departureUtc = new Date(dep.departure_time + "Z"); // force as UTC
        const diffMin = Math.floor((departureUtc - now) / 60000);

        // Skip past departures older than 1 min
        if (diffMin < -1) return;

        let countdown = "";

        if (diffMin < 0) {
          countdown = "DEPARTED";
        } else if (diffMin <= 1) {
          countdown = "ALL ABOARD!";
        }

        const localTime = departureUtc.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        });

        const isHoboken = dep.trip_headsign.toLowerCase().includes("hoboken");

        const card = document.createElement("div");
        card.className = "departure-card";
        card.style.background = isHoboken ? "#ffffff" : "#eeeeee";
        card.style.border = "1px solid #ccc";

        const timeString = countdown
          ? `${localTime} — ${countdown}`
          : `${localTime}`;

        card.innerHTML = `
          <div><strong>${dep.trip_headsign}</strong></div>
          <div>${timeString}</div>
        `;
        container.appendChild(card);
      });
    })
    .catch((err) => {
      document.getElementById("departures").innerText = "Failed to load departures.";
      console.error("Fetch error:", err);
    });
</script>
</body>
</html>
