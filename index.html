<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Clifton Departures</title>
    <style>
      body {
        background-color: black;
        color: white;
        font-family: system-ui, sans-serif;
        padding: 20px;
        text-align: center;
      }

      h1 {
        font-size: 1.5em;
        margin-bottom: 20px;
      }

      .clock {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .card {
        background: white;
        color: black;
        padding: 10px;
        margin: 10px auto;
        width: 90%;
        max-width: 400px;
        border-radius: 10px;
        font-size: 1.2em;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="clock" id="clock">--:--</div>
    <h1>Clifton Station Departures</h1>
    <div id="departures">Loading...</div>

    <script>
      function updateClock() {
        const now = new Date();
        const time = now.toLocaleTimeString([], {
          hour: 'numeric',
          minute: '2-digit'
        });
        document.getElementById("clock").textContent = time;
      }

      setInterval(updateClock, 1000);
      updateClock();

      function renderDepartures(data) {
        const container = document.getElementById("departures");
        container.innerHTML = "";

        const now = new Date();

        data.forEach(dep => {
          const depTimeStr = dep.departure_time;
          const depDate = new Date();
          const [hour, minute] = depTimeStr.split(":").map(Number);
          depDate.setHours(hour, minute, 0, 0);

          const diffMs = depDate - now;
          const diffMin = Math.round(diffMs / 60000);

          const options = { hour: 'numeric', minute: '2-digit' };
          const timeStr = depDate.toLocaleTimeString([], options);

          let text = "";

          if (diffMin < -1) {
            return; // ðŸš« Too far in the past â€” hide it
          } else if (diffMin <= 0) {
            text = `HOBOKEN â€” ${timeStr} (DEPARTED)`;
          } else if (diffMin === 1) {
            text = `HOBOKEN â€” ${timeStr} (ALL ABOARD!)`;
          } else if (diffMin < 60) {
            text = `HOBOKEN â€” ${timeStr} (in ${diffMin} min)`;
          } else {
            text = `HOBOKEN â€” at ${timeStr}`;
          }

          const card = document.createElement("div");
          card.className = "card";
          card.textContent = text;
          container.appendChild(card);
        });

        if (container.children.length === 0) {
          container.innerHTML = "<p>No upcoming departures.</p>";
        }
      }

      fetch('departures.json')
        .then(response => response.json())
        .then(data => renderDepartures(data));
    </script>
  </body>
</html>
